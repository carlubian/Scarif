@using Microsoft.AspNetCore.SignalR.Client
@using Scarif.Core.Model
@inject NavigationManager NavigationManager

<div class="top-row pl-4 navbar navbar-dark">
    <a class="navbar-brand" href="">Scarif Log Server</a>
</div>

<div>
    <ul class="nav flex-column">
        @foreach (var app in Apps)
        {
            <li class="nav-item px-3">
                <NavLink class="nav-link" href="@($"app?id={app.Url}")">
                    <span class="oi oi-list-rich" aria-hidden="true"></span> @app.Name
                </NavLink>
            </li>
        }
    </ul>
</div>

@code {
    private HubConnection SignalR;

    public IEnumerable<ScarifApp> Apps = new List<ScarifApp>();


    protected override async Task OnInitializedAsync()
    {
        SignalR = new HubConnectionBuilder()
            .WithUrl(NavigationManager.ToAbsoluteUri("/scarif"))
            .Build();
        await SignalR.StartAsync();

        Apps = await SignalR.InvokeAsync<IEnumerable<ScarifApp>>("GetAllApps");
    }
}
